#install.packages("tidyverse")
library(tidyverse)

set.seed(123)

iris_sub <- as_tibble(iris) %>% 
  group_by(Species) %>% 
  sample_n(3) %>% 
  ungroup()
print(iris_sub)

# Group operation ---------------------------------------------------------
#Combine group_by() summarize()

df_m_sd <- iris_sub %>% 
  group_by(Species) %>% 
  summarize(mean_s1= mean(Sepal.Length),
            sd = sd(Sepal.Length))

iris_sub %>%
  group_by(Species) %>% 
  mutate(mean_s1= mean(Sepal.Length)) %>% 
  ungroup() %>%
  mutate(eps = abs(Sepal.Length - mean_s1))




# Reshape -----------------------------------------------------------------

iris_w<- iris_sub %>%
  mutate(id = rep(1:3, 3)) %>% # add an ID column
  select(id, Sepal.Length, Species) %>% 
  select(id, Sepal.Length, Species) %>% 
  pivot_wider(id_cols = "id", # unique row ID based on
              values_from = "Sepal.Length", # values in each cell from
              names_from = "Species") # new column names from

# reshape to longer 

iris_1 <- iris_w %>%
  pivot_longer(cols = c("setosa",
                        "versicolor",
                        "virginica" ),
               names_to = "species",
               values_to = "Sepal.Length")

# join --------------------------------------------------------------------

# matching by a single column
## left join by "Species": one to one

df1 <- tibble(Species = c("A", "B", "C"),
              x = c(1, 2, 3))

df2 <- tibble(Species = c("A", "B", "C"),
              y = c(4, 5, 6))

left_join(x = df1,
          y = df2,
          by = "Species")    

left_join(x = df1,
          y= df2,
          by = "Species")

df12<- left_join(x= df1,
                 y= df2,
                 by = "Species")

# what happens if df2 does not contain species B
df2_minus_B<- tibble(Species = c("A", "C"),
                     y= c(4, 6))

left_join(x = df2_minus_B, 
          y = df1)

# Additional resource ------------------------------------------------------

# library(swirl)
# install_course_github("sysilviakim", "swirl-tidy")
# swirl()
